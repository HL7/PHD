<StructureDefinition xmlns="http://hl7.org/fhir">
  <meta>
    <lastUpdated value="2017-12-14T04:24:35.475-05:00" />
  </meta>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-wg">
    <valueCode value="oo" />
  </extension>
  <url value="http://pchalliance.org/phdfhir/StructureDefinition/PhdBitsEnumerationObservation" />
  <name value="PhdBitsEnumerationObservation" />
  <status value="draft" />
  <date value="2017-06-02T14:29:52.39367-04:00" />
  <fhirVersion value="3.0.0" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="Observation" />
  <baseDefinition value="http://pchalliance.org/phdfhir/StructureDefinition/PhdBaseObservation" />
  <derivation value="constraint" />
  <differential>
    <element id="Observation">
      <path value="Observation" />
      <definition value="The PhdBitsEnumerationObservation reports PHD measurements that contain a Enum-Observed-Value-Simple-Bit-Str or Enum-Observed-Value-Basic-Bit-Str attribute." />
      <comment value="This type of measurement is used when the Personal Health Device reports a measurement as an IEEE 11073 10101 BITs value. This measurement is a complex representation where each bit means something. In many cases only certain bits are defined and it is generally true that the significant case is when the bit has been set. Given that measurement could result in up to 32 component entries (one for each bit) only set bits are required to be reported. Some specializations have used this measurement type when they should have used IEEE 10101 codes." />
    </element>
    <element id="Observation.meta">
      <path value="Observation.meta" />
      <min value="1" />
    </element>
    <element id="Observation.meta.profile">
      <path value="Observation.meta.profile" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="PhdBitsEnumerationObservation" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="1" />
    </element>
    <element id="Observation.meta.profile:phdProfile">
      <path value="Observation.meta.profile" />
      <sliceName value="phdProfile" />
      <min value="1" />
      <max value="1" />
      <fixedUri value="PhdBitsEnumerationObservation" />
    </element>
    <element id="Observation.identifier">
      <path value="Observation.identifier" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="value" />
        </discriminator>
        <ordered value="true" />
        <rules value="open" />
      </slicing>
    </element>
    <element id="Observation.identifier:conditionalCreateIdentifier">
      <path value="Observation.identifier" />
      <sliceName value="conditionalCreateIdentifier" />
      <short value="Unique identifier of this measurment for a given patient and device" />
      <definition value="An identifier created from a combination of the measurement parameters like sensor time stamp, type code, enumeration BITs integer, patient and device identifiers, and selected elements of any facet component elements." />
      <comment value="This value is used in the conditional create to prevent data duplication. PHDs will often re-send already sent data for a variety of reasons. This element is required unless the metric measurement contains no time stamp or is a measurement containing a time stamp that is real time. By real time the time stamp reported by the PHD must be later than the current time reported by the PHD before any measurements are received. Temporarily stored data from IEEE 11073 20601 devices, which are required to delete the data after sending, can also be considered real time. Temporarily stored data from Bluetooth Low Energy Health devices may be resent so these cannot be considered as real time. " />
      <requirements value="Allows observations to be distinguished in a selective enough manner to prevent resource duplication." />
      <max value="1" />
    </element>
    <element id="Observation.identifier:conditionalCreateIdentifier.value">
      <path value="Observation.identifier.value" />
      <min value="1" />
    </element>
    <element id="Observation.status">
      <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-display-hint">
        <valueString value="default: final" />
      </extension>
      <path value="Observation.status" />
      <comment value="The value shall be set to 'final' unless a Measurement-Status attribute or Enum-Observed-Value attribute, representing a BITs value, status field indicates that the measurement is preliminary. In that case this field shall be set to 'preliminary'" />
    </element>
    <element id="Observation.code">
      <path value="Observation.code" />
      <comment value="For Enumeration BITs measurements, none will fall into the category of vital signs so a LOINC encoding is never necessary in this profile." />
    </element>
    <element id="Observation.code.coding:11073Type">
      <path value="Observation.code.coding" />
      <sliceName value="11073Type" />
      <comment value="For 11073-20601 metric enumeration measurements, this code is obtained from one or more of the Type, Metric-Id, Enum-Observed-Value.metric, and Metric-Id-Partition attributes. The algorithm to get the 16-bit partition and 16-bit term code is as follows:&#xD;&#xA;&#xD;&#xA;1. The partition and term code are obtained from the Type attribute.&#xD;&#xA;2. If there is a Metric-Id attribute the term code comes from this attribute.&#xD;&#xA;3. If there is a Enum-Observed-Value attribute the term code comes from this attribute.&#xD;&#xA;4. If the term code is NOT from the Type attribute, and there is a Metric-Id-Partition attribute, the partition comes from this attribute.&#xD;&#xA;5. The 32-bit 11073-10101 code value is given by partition * 2 **16 + term code.&#xD;&#xA;&#xD;&#xA;It is this value that is placed in the code.coding.code element for this 11073Type slice" />
    </element>
    <element id="Observation.value[x]">
      <path value="Observation.value[x]" />
      <comment value="The values are reported in Observation.component elements." />
      <max value="0" />
    </element>
    <element id="Observation.dataAbsentReason">
      <path value="Observation.dataAbsentReason" />
      <definition value="Provides a reason why there are Observation.component elements reporting the BITs values present. This would be due to an error condition indicated by the Measurement-Status attribute." />
      <comment value="The current values in the http://hl7.org/fhir/data-absent-reason system do not provide the same detailed set of options reported in the Measurement-Status. In those cases one uses the generic 'error' code if the error is 'fatal'. The measurementStatusComponent can be used to report more specific information." />
    </element>
    <element id="Observation.dataAbsentReason.coding.system">
      <path value="Observation.dataAbsentReason.coding.system" />
      <min value="1" />
    </element>
    <element id="Observation.dataAbsentReason.coding.code">
      <path value="Observation.dataAbsentReason.coding.code" />
      <min value="1" />
    </element>
    <element id="Observation.component">
      <path value="Observation.component" />
      <slicing>
        <ordered value="true" />
        <rules value="open" />
      </slicing>
    </element>
    <element id="Observation.component:bitsComponent">
      <path value="Observation.component" />
      <sliceName value="bitsComponent" />
      <short value="BITs setting entry components" />
      <definition value="Each bitsComponent contains one of the bits settings as code from the BITs measurement. These entries are NOT present if a Measurement-Status attribute indicates an error." />
      <comment value="A BITs measurement is a measurement where each BIT means something, such as a device status where many status situations may be reported." />
      <requirements value="Handles a measurement that may be represented by several different settings." />
    </element>
    <element id="Observation.component:bitsComponent.code.coding">
      <path value="Observation.component.code.coding" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="system" />
        </discriminator>
        <ordered value="false" />
        <rules value="open" />
      </slicing>
      <min value="1" />
    </element>
    <element id="Observation.component:bitsComponent.code.coding:ASN1Type">
      <path value="Observation.component.code.coding" />
      <sliceName value="ASN1Type" />
      <short value="The ANS1 BITs code for the measurement" />
      <comment value="For BITs measurements, this code is an alpha-numeric string created from the code reported in the Observation.code.coding:11073Type.code followed by a dot (.) followed by the MDER bit being reported. For example, the CGM Device status measurement code is 8418060. If the value reported in the BITs field is 0001 1000 0000 0000 the MDER bits set are bits 3 and 4. Note that MDER bit 0 is the HIGH order bit. Bit 3 means 'sensor malfunction' and bit 4 means 'device specific alert'. THis measurement would require two component elements and one would be 8418060.3 and the other would be 8418060.4. Note these are alphas-numeric strings and not decimal numbers. If one took the code 8418060.3 and looked it up in the ASN1 Bits vocabulary one would find it meant 'sensor malfunctioned'." />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="Observation.component:bitsComponent.code.coding:ASN1Type.system">
      <path value="Observation.component.code.coding.system" />
      <comment value="This value is a placeholder until the correct reference URL is registered." />
      <min value="1" />
      <fixedUri value="http://hl7.org/fhir/IEEE.ASN1" />
    </element>
    <element id="Observation.component:bitsComponent.code.coding:ASN1Type.code">
      <path value="Observation.component.code.coding.code" />
      <definition value="A symbol in syntax defined by the IEEE ASN1 system. " />
      <min value="1" />
    </element>
    <element id="Observation.component:bitsComponent.value[x]:valueCodeableConcept">
      <path value="Observation.component.valueCodeableConcept" />
      <sliceName value="valueCodeableConcept" />
      <definition value="The information determined as a result of making the observation, if the information is a code." />
      <comment value="If the application wishes to report an unsupported setting, this element is absent and the dataAbsentReason is used to report the condition." />
      <type>
        <code value="CodeableConcept" />
      </type>
    </element>
    <element id="Observation.component:bitsComponentComponent.value[x]:valueCodeableConcept.coding">
      <path value="Observation.component.valueCodeableConcept.coding" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="system" />
        </discriminator>
        <ordered value="true" />
        <rules value="open" />
      </slicing>
    </element>
    <element id="Observation.component:bitsComponentComponent.value[x]:valueCodeableConcept.coding:v2BinaryValue">
      <path value="Observation.component.valueCodeableConcept.coding" />
      <sliceName value="v2BinaryValue" />
      <min value="1" />
    </element>
    <element id="Observation.component:bitsComponentComponent.value[x]:valueCodeableConcept.coding:v2BinaryValue.system">
      <path value="Observation.component.valueCodeableConcept.coding.system" />
      <min value="1" />
      <fixedUri value="http://hl7.org/fhir/v2/0136" />
    </element>
    <element id="Observation.component:bitsComponentComponent.value[x]:valueCodeableConcept.coding:v2BinaryValue.code">
      <path value="Observation.component.valueCodeableConcept.coding.code" />
      <definition value="If the bit is set this code is 'Y' and 'N' if the bit is cleared. Only set bits are required to be reported. If the bit is unsupported, the dataAbsentReason code &quot;unsupported' is used. Unsupported bits are optional to report." />
      <min value="1" />
    </element>
    <element id="Observation.component:bitsComponent.dataAbsentReason">
      <path value="Observation.component.dataAbsentReason" />
      <definition value="Provides a reason why the expected value in the element Observation.component.value[x] is missing. In this profile for this component that happens if the PHD does not support this bit and the uploader wishes to report that situation." />
    </element>
    <element id="Observation.component:bitsComponent.dataAbsentReason.coding">
      <path value="Observation.component.dataAbsentReason.coding" />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="Observation.component:bitsComponent.dataAbsentReason.coding.system">
      <path value="Observation.component.dataAbsentReason.coding.system" />
      <min value="1" />
    </element>
    <element id="Observation.component:bitsComponent.dataAbsentReason.coding.code">
      <path value="Observation.component.dataAbsentReason.coding.code" />
      <definition value="Indicates the bit is not supported by the device" />
      <min value="1" />
      <fixedCode value="unsupported" />
    </element>
  </differential>
</StructureDefinition>