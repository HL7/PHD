<StructureDefinition xmlns="http://hl7.org/fhir">
  <meta>
    <lastUpdated value="2017-12-14T09:41:34.341-05:00" />
  </meta>
  <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-wg">
    <valueCode value="oo" />
  </extension>
  <url value="http://pchalliance.org/phdfhir/StructureDefinition/PhdCoincidentTimeStampObservation" />
  <name value="PhdCoincidentTimeStampObservation" />
  <status value="draft" />
  <date value="2017-06-02T14:29:52.39367-04:00" />
  <description value="Base StructureDefinition for Observation Resource representing the coincident time stamp. This report is a measurement of the current time of the sensor at the current time of the PHG. The purpose of this observation is to record the difference in the time lines between the PHG and PHD and to be able to recover the original measurement time stamps reported by the PHD should the PHG correct them because the sensor clock is in error." />
  <fhirVersion value="3.0.0" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="Observation" />
  <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Observation" />
  <derivation value="constraint" />
  <differential>
    <element id="Observation">
      <path value="Observation" />
      <definition value="The PhdCoincidentTimeStampObservation reports the current time of the PHD sensor at the current time of the PHG." />
      <comment value="Used to record the correction the PHG applied to the PHD measurement time stamps (if any) and to be able to recover the original time stamps reported by the PHD should that be needed." />
    </element>
    <element id="Observation.meta">
      <path value="Observation.meta" />
      <comment value="Implementations must indicate the PhdCoincidentTimeStampObservation profile this resource adheres to." />
      <min value="1" />
    </element>
    <element id="Observation.meta.profile">
      <path value="Observation.meta.profile" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="PhdCoincidentTimeStampObservation" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <definition value="A list of profiles (references to [StructureDefinition](structuredefinition.html#) resources) that this resource claims to conform to. The URL is a reference to [StructureDefinition.url](). At least one entry must be PhdCoincidentTimeStampObservation" />
      <min value="1" />
    </element>
    <element id="Observation.meta.profile:phdProfile">
      <path value="Observation.meta.profile" />
      <sliceName value="phdProfile" />
      <min value="1" />
      <max value="1" />
      <fixedUri value="PhdCoincidentTimeStampObservation" />
    </element>
    <element id="Observation.status">
      <extension url="http://hl7.org/fhir/StructureDefinition/structuredefinition-display-hint">
        <valueString value="default: final" />
      </extension>
      <path value="Observation.status" />
      <definition value="The status of the result value. Always 'final'" />
      <comment value="The value shall be set to 'final'" />
      <fixedCode value="final" />
    </element>
    <element id="Observation.code.coding">
      <path value="Observation.code.coding" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="system" />
        </discriminator>
        <ordered value="true" />
        <rules value="open" />
      </slicing>
      <min value="1" />
    </element>
    <element id="Observation.code.coding:11073Type">
      <path value="Observation.code.coding" />
      <sliceName value="11073Type" />
      <short value="The 11073-10101 code for the type of time clock used by the PHD" />
      <comment value="PHDs use one of absolute time, base offset time, relative time, or high resolution relative time." />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="Observation.code.coding:11073Type.system">
      <path value="Observation.code.coding.system" />
      <min value="1" />
      <fixedUri value="urn:iso:std:iso:11073:10101" />
    </element>
    <element id="Observation.code.coding:11073Type.code">
      <path value="Observation.code.coding.code" />
      <comment value="The code for absolute time is 67975 with reference id MDC_ATTR_TIME_ABS, for base offset time is 68226 with reference id MDC_ATTR_TIME_BO, for relative time is 67983 with reference id MDC_ATTR_TIME_REL, and for high resolution relative time is 68072 with reference id MDC_ATTR_TIME_REL_HI_RES." />
      <min value="1" />
    </element>
    <element id="Observation.subject">
      <path value="Observation.subject" />
      <min value="1" />
    </element>
    <element id="Observation.subject.reference">
      <path value="Observation.subject.reference" />
      <min value="1" />
    </element>
    <element id="Observation.effective[x]:effectiveDateTime">
      <path value="Observation.effectiveDateTime" />
      <definition value="The time of the PHG at the time the current time of the PHD is ascertained." />
      <comment value="This element is absent if the PHD has superior time synchronization relative to the PHG. Wnen this element is absent it indicates that the PHG reported the measurement time stamps of the PHD without modification." />
      <type>
        <code value="dateTime" />
      </type>
    </element>
    <element id="Observation.value[x]">
      <path value="Observation.value[x]" />
      <slicing>
        <discriminator>
          <type value="exists" />
          <path value="system" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <definition value="The current time reported by the PHD unless there is a time fault in which case this element is absent and the dataAbsentReason indicates 'unknown'" />
      <comment value="This observation is a measurement of the PHDs current time at the current time of the PHG and is present to allow a comparison and auditing. PHGs are responsible for assuring the measurement time stamps are correctly aligned to UTC and local offset. If the PHD has superior time synchronization than the PHG (very rare with PHDs) only the current time of the PHD is shown and the effectiveDateTime element is absent. If the PHD has a time fault (the current time line of the PHD cannot be ascertained for the measurements uploaded) the value[x] element is absent. If the PHD reports no time stanps in its measurements, this resource is not needed." />
      <requirements value="The primary reason for the coincident time stamp is to know the details of any time stamp corrections the PHG may have applied." />
    </element>
    <element id="Observation.value[x]:dateTimeValue">
      <path value="Observation.value[x]" />
      <sliceName value="dateTimeValue" />
      <definition value="This reports the current time of the PHD when the real time clock uses either absolute time or base offset time" />
      <type>
        <code value="dateTime" />
      </type>
    </element>
    <element id="Observation.value[x]:relativeTimeValue">
      <path value="Observation.value[x]" />
      <sliceName value="relativeTimeValue" />
      <type>
        <code value="Quantity" />
      </type>
    </element>
    <element id="Observation.value[x]:relativeTimeValue.value">
      <path value="Observation.value[x].value" />
      <definition value="The current relative or high resolution relative time reported by the PHD scaled to units of microseconds." />
      <comment value="The current relative time forms the 'origin' of the time axis allowing the PHG to convert the PHD's relative time stamps to wall-clock time. The PHG knows the current wall clock time at this current relative time. Any measurement relative time stamp can be converted to wall clock time by subtracting this value from the measurement relative time stamp and adding that to the current wall-clock time recorded at the 'origin' relative time." />
      <min value="1" />
    </element>
    <element id="Observation.value[x]:relativeTimeValue.unit">
      <extension url="http://hl7.org/fhir/StructureDefinition/elementdefinition-translatable">
        <valueBoolean value="true" />
      </extension>
      <path value="Observation.value[x].unit" />
      <definition value="A human-readable form of the unit. This should be the UCUM code 'us' for microseconds." />
    </element>
    <element id="Observation.value[x]:relativeTimeValue.system">
      <path value="Observation.value[x].system" />
      <definition value="Identifies the MDC coding system" />
      <min value="1" />
      <fixedUri value="urn:iso:std:iso:11073:10101" />
    </element>
    <element id="Observation.value[x]:relativeTimeValue.code">
      <path value="Observation.value[x].code" />
      <definition value="The 32-bit 11073 10101 code for microseconds which is 264339." />
      <comment value="The 11073-10101 code is used as this comes from the device. This usage allows gateways responsible for translating device measurements to FHIR to handle future specializations they may introduce new codes. If a translation to another coding system is done instead, that gateway would not be able to process the measurement." />
      <min value="1" />
      <fixedCode value="264339" />
    </element>
    <element id="Observation.dataAbsentReason">
      <path value="Observation.dataAbsentReason" />
      <definition value="In this profile this element indicates that the current time of the PHD for the measurements reported is not known and is unable to be obtained" />
      <comment value="This situation arises when the PHD has a time fault, perhaps by battery change. The sensor device may have stored data with time stamps taken at a time when the clock was running but after the fault the original time line was not able to be recovered. Thus the current time line, if any, has an unknown relationship to the previous time line." />
    </element>
    <element id="Observation.dataAbsentReason.coding">
      <path value="Observation.dataAbsentReason.coding" />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="Observation.dataAbsentReason.coding.system">
      <path value="Observation.dataAbsentReason.coding.system" />
      <min value="1" />
      <fixedUri value="http://hl7.org/fhir/data-absent-reason " />
    </element>
    <element id="Observation.dataAbsentReason.coding.code">
      <path value="Observation.dataAbsentReason.coding.code" />
      <min value="1" />
      <fixedCode value="unknown" />
    </element>
    <element id="Observation.device">
      <path value="Observation.device" />
      <comment value="This field will reference the DeviceComponent when the updated fixes are in place. In the meantime it will reference the DeviceMetric" />
      <min value="1" />
    </element>
    <element id="Observation.device.reference">
      <path value="Observation.device.reference" />
      <short value="Reference to the device responsible for the measurement" />
      <definition value="Reference to the device-related resources that describe the sensor device taking the measurement and the gateway that handled it." />
      <comment value="This reference points to the DeviceComponent resource chain containing information about the sensor device  that took the measurement and gateway (if any) that handled it." />
      <min value="1" />
    </element>
  </differential>
</StructureDefinition>