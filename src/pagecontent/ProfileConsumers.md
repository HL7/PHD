<style>table, th, td {
border: 1px solid black;
border-collapse:collapse;
padding: 6px;}</style>

This chapter is for those whose use cases require measurement data from Personal Health Devices (PHD) and need that data in FHIR format. In most cases PHDs are used when the measurements are taken by individuals who are not medical professionals and outside of the health care provider's institution. The individuals could be patients recovering at home from a serious operation, diabetics managing their condition while trying to live as normal a life as possible, or athletes wearing fitness devices keeping track of their training. Point of Care Devices (PoCD) used in acute care are not covered by this IG. There is a separate implementation guide [here](http://build.fhir.org/ig/HL7/uv-pocd) for such devices.

It is important to understand that this Implementation Guide (IG) assumes that the source of the data is from *communicating* PHDs. This IG does NOT cover measurement data entered manually, such as a pulse rate by putting one's fingers on the wrist, or reading data from a non-communicating medical device. Manual entry of data is subject to human error which this IG does not consider.

Understanding the content of the FHIR resources specified in this IG should be straight forward. Familiarity with the [MDC](http://build.fhir.org/mdc.html) coding system is the only IEEE 11073 domain-specific knowledge required. In addition, there is only one extension used in the PHD related profiles and that is a reference to the Personal Health Gateway (PHG) Device resource in the PHD Observation profiles. A PHG is the unit that is typically responsible for communicating with the PHD and encoding that data into FHIR. It may be a mobile phone, a PC, or a dedicated set-top box. Most of this IG is dedicated to the PHD to FHIR mapping that a PHG must follow. Those sections do require IEEE 11073 domain knowledge.

PHGs following this IG use only three FHIR resources, Patient, Device, and Observation. A Device resource is used for the PHG properties and a second Device resource is used for the PHD properties. Observation resources are used for each measurement and the [Coincident Time Stamp](CoincidentTimeStamp.html). The Coincident Time Stamp will be further discussed in this chapter as well.

The next sections examine each of the resources generated by PHGs following this IG. 

### The Measurement Observation Resources

PHDs measurements are encoded into Observation resources. There are six types of measurement values that can be reported by PHDs. Each measurement value type has its own profile but the profiles differ only in the way the value of the measurement is reported in the Observation resource. The six measurement value types are:

 - **single scalar** such as a temperature, weight, glucose concentration, pulse rate, blood oxygen saturation, or miles run. Scalar measurements are the most common type of measurement and *usually* have a unit. All measurements in this category follow the [Phd Numeric Observation Profile](PhdNumericObservation.html) and can be identified when the Observation.meta.profile="http://hl7.org/fhir/uv/phd/StructureDefinition/PhdNumericObservation".
 - **compound or vector** measurements such as the systolic, diastolic, and mean components of the blood pressure or x-, y-, and z- components of an acceleration. Compound measurements *usually* have units. All measurements in this category follow the [Phd Compound Numeric Observation Profile](PhdCompoundNumericObservation.html) and can be identified when the Observation.meta.profile="http://hl7.org/fhir/uv/phd/StructureDefinition/PhdCompoundNumericObservation".
 - **coded** measurements such as the meal context and health status in a glucose monitor. A coded measurement is used when there is a limited set of options and each option is specified by a code. In the case of the meal context some of the options are pre-meal, post-meal, bedtime, fasting, etc. All measurements in this category follow the [Phd Coded Enumeration Observation Profile](PhdCodedEnumerationObservation.html) and can be identified when the Observation.meta.profile="http://hl7.org/fhir/uv/phd/StructureDefinition/PhdCodedEnumerationObservation".
 - **state or event** measurements which report a set of conditions that may occur simultaneously. An example would be a room status measurement in an independent living facility such as patient in room, door closed, window closed, climate control off, and video monitoring off. All measurements in this category follow the [Phd Bits Enumeration Observation Profile](PhdBitsEnumerationObservation.html) and can be identified when the Observation.meta.profile="http://hl7.org/fhir/uv/phd/StructureDefinition/PhdBitsEnumerationObservation".
 - **periodic samples** (often waveforms) such as an ECG trace, a forced exhalation flow rate from a spirometer, a pleth wave of a pulse oximeter, or a sequence of heart rates. These measurements are a periodic sequence of scalars and *usually* have units.  All measurements in this category follow the [Phd Rtsa Observation Profile](PhdRtsaObservation.html) and can be identified when the Observation.meta.profile="http://hl7.org/fhir/uv/phd/StructureDefinition/PhdRtsaObservation".
 - **string** measurements which are just arbitrary human-readable strings. These kinds of measurements are rare as they cannot be processed by machine. All measurements in this category follow the [Phd String Enumeration Observation Profile](PhdStringEnumerationObservation.html) and can be identified when the Observation.meta.profile="http://hl7.org/fhir/uv/phd/StructureDefinition/PhdStringEnumerationObservation".

### Common Observation Element Fields
Every PHD measurement Observation resource contains the following information regardless of the measurement value type:

|Measurement item|element|Description|
|-
|profile|Observation.meta.profile|This element contains the URL to the structure definition identifying the profile this Observation belongs to.|
|measurement type|Observation.code.coding.code|This element tells you what the measurement is. There shall be at least one coding element using the MDC coding system identified by Observation.code.coding.system="urn:iso:std:iso:11073:10101"<br>If a vital sign, there will be an additional coding element using one of the LOINC 'magic' codes. There will also be an Observation.category element as demanded by the vital signs profile. Additional coding elements representing the same concept as the MDC code in other coding systems may be present.|
|time stamp|Observation.dateTimeEffective<br/><br/>Observation.period|If the measurement is a point in time.<br/><br/>If the measurement has a duration.|
|PHG reference|Observation.extension.valueReference|This element points to the PHG Device resource. The resource contains information about the PHG that generated the FHIR resources. The gateway extension is the only extension used in this guide. It is identified by Observation.extension.url="http://hl7.org/fhir/StructureDefinition/observation-gatewayDevice"|
|patient reference|Observation.subject|Points to the Patient resource. Contains information about the patient to whom this measurement refers|
|PHD reference|Observation.device|Points to the PHD Device resource. This resource contains information about the PHD that took the measurement|

In addition to the elements that are always present, the following set of elements may be present.

|Measurement item|element|Description|
|-
|coincident time stamp|Observation.derivedFrom|Points to Observation following the Coincident Time Stamp Observation profile. For time quality auditing purposes. Only present when the PHD provides a time stamp |
|related measurement|Observation.derivedFrom|Points to a PHD Observation that is related to this Observation. An example would be a miles run measurement that points to the activity session measurement. Not present if the measurement does not reference an additional measurement.|
|additional descriptions|Observation.component|Sometimes a measurement is sent containing additional information such as the technique used to obtain the measurement. These elements are placed in a component.|
||Observation.identifier|IGNORE! This element is used to prevent data duplication during uploads. The reader should ignore this field.|

### Description of the Fields
In this section each of the fields summarized above is discussed.
#### The Profile: Observation.meta.profile
For the consumer the PHD profile element tells one what type of measurement value the Observation has. For example, if Observation.meta.profile entry contains "http://hl7.org/fhir/uv/phd/StructureDefinition/PhdNumericObservation" one knows that this measurement is a scalar. As discussed in the Phd Numeric Observation Profile section, scalars are mapped to a valueQuantity element, thus one knows the value[x] element is of type valueQuantity, which may make parsing the value[x] element a little simpler.

#### The Measurement Type: Observation.code.coding.code
The measurement type tells what the measurement is. In HL7 such information is typically done through codes and it is no different here. However, one must understand the coding system in order to interpret what the code means. Consumers of the PHD profiles must understand the MDC code system to interpret the measurement. The MDC code system consists of 32-bit integers. Examples of some common MDC codes are

|MDC Code|Description|
|-
|150456|Pulse Oximeter Oxygen Saturation|
|149530|Pulse Oximeter Pulse Rate|
|188736|Body Mass|
|150020|Non invasive blood pressure|
|149546|Non invasive pulse rate|
|150364|Body temperature|
|188424|Oral temperature|
|160368|Glucose concentration in plasma|

A comprehensive list of MDC codes is available using the [NIST RTMSS Rosetta](https://rtmms.nist.gov/rtmms/index.htm).  It provides descriptions and, if applicable, the units associated with the measurement in both MDC and UCUM. The Rosetta is still a work in progress and one may find the user interface a little hard to navigate. One can find more information about the MDC code system [here](http://build.fhir.org/mdc.html).

For those consumer applications that would like to have the codes as LOINC and the uploader did not provide them, there is a mapping from MDC to LOINC available for download [here](https://loinc.org/file-access/download-id/9385/). One may freely download and use this table as needed in an implementation license free, but it does require that one create a (free) login account. At the time of this writing there is no comprehensive mapping of MDC to other code systems such as SNOMED CT. A mapping from MDC to SNOMED CT for some of the more common codes is available in the 2017 Continua Design Guidelines [H.813 HIS Interface](https://www.pchalliance.org/continua-design-guidelines) document. The guidelines are freely available for download, however it is not known what the licensing requirements are for use of the SNOMED CT code system.

##### Vital Signs
FHIR requires that a LOINC 'magic' code be present if the measurement is one of the vital signs given [here](http://build.fhir.org/observation-vitalsigns.html). In that case, the Observation.code shall have at least a second coding element containing the LOINC magic code. *The consumer must be aware that the MDC-to-LOINC mapping may be many to one*. For example, both the pulse rate obtained from a Blood Pressure Cuff (149546) and the pulse rate obtained from a Pulse Oximeter (149530) may be mapped to the same LOINC magic code (8867-4). In addition to the LOINC magic code, FHIR requires an Observation.category.coding.code element with value "vital-signs" when the measurement is a vital sign. Outside of this special case FHIR requirement, the PHD measurement profiles do not use the Observation.category element.

Below is a snippet showing a code element for a measurement type that is a vital sign (body temperature):

    "code": {
        "coding": [
            {
                "system": "urn:iso:std:iso:11073:10101",
                "code": "150364"
            },
            {
                "system": "http://loinc.org",
                "code": "8310-5"
            }
        ],
        "text": "MDC_TEMP_BODY: Body temp"
    }

##### Caveats
The PHG may express the code in additional coding systems but the consumer cannot rely on it. The PHD profiles in this IG require *only* the MDC code as it is provided by the PHD and the LOINC magic code if the measurement is a vital sign. It is also possible that a vital sign is *not* mapped to LOINC by the PHG. By design, the PHG is written to map the data from the PHD without any knowledge to what the data is. The exception is for the LOINC magic codes which require the PHG to pre-code a map. If a new PHD specialization is created after the PHG is already implemented, the new PHD may possess a new MDC code and the new code may be a vital sign (perhaps the new code represents a pulse rate obtained via a new technique). The PHG can still populate the Observation.code.coding.code with the MDC code as that is provided in the PHD protocol, but the new MDC code will not be in its pre-coded local map of MDC codes to LOINC magic codes.

#### The Time Stamp: Observation.effective[x]
All measurements contain a time stamp which is either an instant in time, a dateTime data type, or a period of time, a Period data type. The period has both a start and end. Results of a workout session are a common type of measurement with a period. The 'instant' data type is not used as it is permissible for PHDs to report time at resolutions greater than a day in which case there is no time zone. An activity monitor reporting only daily summaries could be an example of a PHD using such a resolution.

All time stamps with resolutions finer than a day contain the offset to UTC. If the offset is -00:00, it means that the offset to local time is not known, and what is being reported is UTC time, even though the measurement is taken in Japan. If the offset is +00:00, it means the offset IS known; the measurement just happens to be in a time zone that is UTC. 

Below is an example of the effective[x] when the time stamp is an instant in time:

    "effectiveDateTime": "2019-05-10T16:47:31-04:00"

##### The Coincident Time Stamp
The consumer can obtain further information about the time stamp from the coincident time stamp Observation identified by the profile value "http://hl7.org/fhir/uv/phd/StructureDefinition/PhdCoincidentTimeStampObservation". A reference to the coincident time stamp Observation may be present in the Observation.derivedFrom element. If the reference is NOT present, it means that the PHD did not provide a time stamp, and the PHG used the time of reception as the time stamp. Only PHDs that send live data are allowed to send measurements without time stamps.

If the PHD sent the measurement with a time stamp, there will be an Observation.derivedFrom element referencing the coincident time stamp Observation resource. This Observation resource can be used to see if the PHG needed to correct the time stamp, and if it did, by how much, or whether the PHD had a time fault. A time fault means the PHD had measurements with time stamps but lost its sense of current time for those measurements. Such an error could occur on a battery change or from a bug in the PHD code. If the PHD loses its sense of current time there is no way for the PHG to validate the time stamps or correct them. Time faults need to be reported to assure that the end user of the data is aware that the time stamps are untrustworthy.

Additional information about the Coincident Time Stamp can be found [here](CoincidentTimeStamp.html).

#### The PHG reference: Observation.extension.valueReference:
The reference to the Device resource containing the PHG properties is the only extension used in this implementation guide. An example of the element is shown below:

    "extension": [
        {
            "url": "http://hl7.org/fhir/StructureDefinition/observation-gatewayDevice",
            "valueReference": {
                "reference": "Device/12"
            }
        }
    ]

The extension is one of the [registered extensions](http://hl7.org/fhir/observation-profiles.html) for Observations.

#### The PHD reference: Observation.device:
The reference to the Device resource containing the properties of the PHD that took the measurement is placed in the Observation.device element.

#### The Patient reference: Observation.subject:
The reference to the Patient resource containing information about the patient upon whom the measurement was taken is placed in the Observation.subject element.

#### References to Other Observations: Observation.derivedFrom.reference:
There are situations where a given Observation is an important part of another Observation such as a glucose meal context measurement giving additional information about a glucose concentration measurement. In that case the context measurement will have an Observation.derivedFrom.reference element that points to the Observation resource containing the glucose measurement. Another common case where an Observation references another Observation is in an activity monitor. Results of an exercise session such as miles run, calories burned, average and maximum heart rates, etc. are reported as Observations where each Observation points to the master session Observation which has the activity type and duration (period).

The most common use of this element will be for referencing the Coincident Time Stamp Observation. Every measurement where the PHD provides a time stamp will reference a Coincident Time Stamp Observation.

An example of a reference to another Observation is shown below:

    "derivedFrom": [
        {
            "reference": "Observation/1294"
        }
    ]

There is no way to ascertain from the reference whether the Observation is a Coincident Time Stamp Observation or another measurement Observation. One must examine the Observation.meta.profile element of the referenced Observation to ascertain that information.

#### Additional Descriptions: Observation.component:
PHDs can send measurements that have additional descriptive information. An example would be a pulse oximeter indicating the modality used when taking the measurement. Some of the additional information reported can only occur if the measurement value is a of a specific value type such as a quantity. Additional information is reported in an Observation.component element. The type of additional information is given by the Observation.component.code element. The value of the additional information is given by the Observation.component.value[x] element. PHDs support the following types of additional information:

|Type of additional information|code|When it can occur|component.value[x]|Description|
|-
|supplemental type|68193 (MDC code)|Can occur with all measurement values|valueCodebaleConcept| provides a further description of the measurement type. Can be multiple supplemental type component entries.|
|relative time stamp|67985 (MDC code)|Can occur with all measurement values|valueQuantity| Gives the value of the time stamp when relative times are used|
|high resolution relative time stamp|68073 (MDC code)|Can occur with all measurement values|valueQuantity| Gives the value of the time stamp when high resolution relative times are used|
|Accuracy|67914 (MDC code)|Only Quantities|valueQuantity| Gives the accuracy of the measurement value in the units of the measurement value|
|Alert operational state|68746.n (ASN1ToHL7 code where n = 0, 1, or 2)|Only Quantities|valueCodeableConcept (V2 binary 'Y' or 'N')| Determines whether an alert threshold is off or on.|
|Alert operational text string|68104 (MDC code)|Only Quantities|valueString| A human readable string describing the lower and upper alert thresholds in that order.|
|Current Limits|67892 (MDC code)|Only Quantities|valueRange| The lower and upper threshold values in the units of the reported measurement quantity|
|Measurement Confidence 95|526998 (MDC code)|Only Quantities|valueRange| Gives a range that the manufacturer is 95% confident that the actual reported measurement is within that bounds|
|Threshold notification string|68232 (MDC code)|Only Quantities|valueString| Human readable string describing thresholds. Similar to the Alert operational text string|

At the time of this writing, only the supplemental types and the high resolution relative time stamp 'additional descriptions' are used by market PHDs. Some of the text string descriptions are unlikely to ever be used given that the IEEE 11073 20601 specification only allows ASCII 127 and consumers of the data are likely to provide their own descriptions customized to their locale.

##### Supplemental Types
Supplemental type information is indicated by the Observation.component.code.coding.code element having the value 68193. The value type of a supplemental type entry is always a CodeableConcept and is therefore given by Observation.component.valueCodeableConcept.coding.code. There may be more than one Observation.component entry containing supplemental type information. An example of a supplemental types component entry is as follows:

    "component": [
        {
            "code": {
                "coding": [
                    {
                        "system": "urn:iso:std:iso:11073:10101",
                        "code": "68193"
                    }
                ],
                "text": "MDC_ATTR_SUPPLEMENTAL_TYPES: Supplemental information"
            },
            "valueCodeableConcept": {
                "coding": [
                    {
                        "system": "urn:iso:std:iso:11073:10101",
                        "code": "150588"
                    }
                ],
                "text": "MDC_MODALITY_SPOT: Modality Spot"
            }
        }
    ]

A 'spot modality' means that the pulse oximeter sensed over a period long enough to obtain a stable average.

##### Relative Times
A PHD may use a relative time clock. A relative time clock is nothing but a series of ticks with a fixed interval between ticks. The IEEE 11073 20601 standard allows for two types of relative time clocks where the standard specifies what the fixed interval between ticks is. Clearly such a clock is much simpler for a PHD to implement. As long as the PHD provides its current tick value, the PHG can convert these relative times to a user-friendly wall clock time. The time stamp reported in the Observation.effective[x] element is always the user-friendly wall clock time.

However, there may be use cases where the relative time stamp is desired. Relative time stamps have, by spec, a resolution of either 125 microseconds or microseconds depending upon which relative time clock is used. FHIR only reports time stamps to the millisecond. If one's use case requires knowing the time stamp to the microsecond, one will need to obtain the reported ticks in this component element. The coincident time stamp Observation will, in this case have information about the current relative time ticks, if, for some reason that is needed. 

Note that just because a PHD uses a relative time clock it does not mean that the PHD reports the time stamp at that resolution. One must look at the corresponding PHD Device resource to see what the actual resolution of the relative time clock is.

At the time of this writing there are no PHDs on the market that use relative time stamps because they need very precise time stamps for their measurements. Relative time stamp use has been for simplicity and reduced power consumption. Devices that need very precise time stamps are much more likely to be Point of Care Devices (PoCDs) used in hospital environments.

There are two types relative time stamps defined by IEEE 11073 20601. A 'relative time' with a maximum resolution of 125 microseconds and a 'high resolution relative time' with a maximum resolution of microseconds. Which relative time stamp is used is given by the MDC code in the Observation.component.code.coding.code element:

|MDC Code|Description|
|-
|67985|Relative Time|
|68073|High resolution relative time|

The value of the relative time is reported as a valueQuantity in units of microseconds for BOTH types of relative time stamps. An example of a component containing high resolution relative time stamp information is as follows:

    "component": [
        {
            "code": {
                "coding": [
                    {
                        "system": "urn:iso:std:iso:11073:10101",
                        "code": "68073"
                    }
                ],
                "text": "MDC_ATTR_TIME_STAMP_REL_HI_RES: High resolution relative time stamp"
            },
            "valueQuantity": {
                "value": 1234534,
                "system": "http://unitsofmeasure.org",
                "code": "us"
            }
        }
    ]

##### Accuracy
##### Alert Operational State
##### Alert Operational Text String
##### Current Limits
##### Measurement Confidence 95
##### Threshold Notification String

### Measurement Status
Every real device is going to experience challenges at some time. These challenges can interfere with the measurement and therefore need to be reported. One could argue that measurements with errors should not be delivered, but in a scenario where the PHG might be headless and one is happy that the patient can even take the measurement, it may be important to know that the measurement attempt was made. Therefore this IG will report any measurement it receives from the PHD including error states and let the end user decide what to do with it.

There are other non-error special conditions that may also be reported, such as the measurement is test or demo data.

Depending upon what the special condition is, it is reported in either the dataAbsentReason, interpretation, or meta.security element. All of these entries are CodeableConcepts. When the condition is reported in the dataAbsentReason, there will be no measurement value entry in accord with the FHIR specification, even if the PHD reports a measurement value.

The table below lists the special conditions reported and in what elements they are found. The code system from which the code is drawn is also shown.

|Condition reported by PHD | Observation element and code system used|
|-
|measurement invalid|dataAbsentReason.coding.code="error"<br/>dataAbsentReason.coding.system="http://terminology.hl7.org/CodeSystem/data-absent-reason"|
|measurement questionable|interpretation.coding.code="questionable" <br/> interpretation.coding.system="http://hl7.org/fhir/uv/pocd/CodeSystem/measurement-status" |
|measurement not available|dataAbsentReason.coding.code="not-performed"<br>dataAbsentReason.coding.system="http://terminology.hl7.org/CodeSystem/data-absent-reason |
|calibration ongoing|interpretation.coding.code="calibration-ongoing"<br/> interpretation.coding.system="http://hl7.org/fhir/uv/pocd/CodeSystem/measurement-status" |
|test data|meta.security.coding.code="HTEST"<br/> meta.security.coding.system="http://terminology.hl7.org/CodeSystem/v3-ActReason" |
|demo data|meta.security.coding.code="HTEST"<br/> meta.security.coding.system="http://terminology.hl7.org/CodeSystem/v3-ActReason" |
|validated data|interpretation.coding.code="validated-data" <br/>interpretation.coding.system="http://hl7.org/fhir/uv/pocd/CodeSystem/measurement-status"  |
|early indication|interpretation.coding.code="early-indication" <br/> interpretation.coding.system="http://hl7.org/fhir/uv/pocd/CodeSystem/measurement-status" |
|measurement ongoing|dataAbsentReason.coding.code="temp-unknown"<br>dataAbsentReason.coding.system="http://terminology.hl7.org/CodeSystem/data-absent-reason" |
|measurement value exceeded boundaries|interpretation.coding.code="in-alarm" <br/>interpretation.coding.system="http://hl7.org/fhir/uv/pocd/CodeSystem/measurement-status" |
|alarm indication turned off|interpretation.coding.code="alarm-inhibited"<br/>interpretation.coding.system="http://hl7.org/fhir/uv/pocd/CodeSystem/measurement-status" |

In addition to the conditions listed above, when the measurement value is a quantity, PHDs may also report one of a set of special values, "Not a Number", "Positive infinity", or "Negative infinity". These errors can results from a failure of the floating point software or hardware, or the inability of the sensor to completely acquire a value. These errors are reported in the dataAbsentReason element and will be discussed in the sections discussing the measurement values. "Not a Number" is the most common special condition reported by PHDs currently on the market. Reporting of the other special situations listed above are, in practice, rare.


### The Profile Structure Definitions

 - [Base Observation Profile](PhdBaseObservation.html)
 - [Numeric Observation Profile](PhdNumericObservation.html)
 - [Compound Numeric Observation Profile](PhdCompoundNumericObservation.html)
 - [Coded Enumeration Observation Profile](PhdCodedEnumerationObservation.html)
 - [BITs Enumeration Observation Profile](PhdBITsEnumerationObservation.html)
 - [Rtsa Observation Profile](PhdRtsaObservationProfile.html)
 - [String Enumeration Observation Profile](PhdStringEnumerationObservation.html)
 - [Coincident Time Stamp Observation Profile](PhdCoincidentTimeStampObservation.html)
 - [Phd Device Profile](PhdDevice.html)
 - [Phg Device Profile](PhgDevice.html)
 - [Patient Profile](PhdPatient.html)




 
